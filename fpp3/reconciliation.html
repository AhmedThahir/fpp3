<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>11.3 Forecast reconciliation | Forecasting: Principles and Practice (3rd ed)</title>
  <meta name="description" content="3rd edition" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="11.3 Forecast reconciliation | Forecasting: Principles and Practice (3rd ed)" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://Otexts.com/fpp3///figs/fpp3_front_cover.jpg" />
  <meta property="og:description" content="3rd edition" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="11.3 Forecast reconciliation | Forecasting: Principles and Practice (3rd ed)" />
  <meta name="twitter:site" content="@robjhyndman" />
  <meta name="twitter:description" content="3rd edition" />
  <meta name="twitter:image" content="https://Otexts.com/fpp3///figs/fpp3_front_cover.jpg" />




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="single-level.html"/>
<link rel="next" href="tourism.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { 
    equationNumbers: { autoNumber: "AMS" } ,
    Macros: {
      bm: ["\\boldsymbol{#1}",1],
      y:    ["y_{\\text{#1},#2}",2],
      yhat: ["\\hat{y}_{\\text{#1},#2}",2],
      ytilde: ["\\tilde{y}_{\\text{#1},#2}",2],
      Shat: ["\\hat{S}_{\\text{#1},#2}^{(#3)}",3]
    }
  }
});
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-27933797-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-27933797-2');
  gtag('config', 'G-JKBLG3XQGY');
</script>
<link href="https://fonts.googleapis.com/css?family=Fira+Sans|Merriweather" rel="stylesheet">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3/build/web/hack-subset.css">
<script>
  /*
   * Light YouTube Embeds by @labnol
   * Credit: https://www.labnol.org/
   */

  function labnolIframe(div) {
    var iframe = document.createElement('iframe');
    iframe.setAttribute('src', 'https://www.youtube.com/embed/' + div.dataset.id + '?autoplay=1');
    iframe.setAttribute('frameborder', '0');
    iframe.setAttribute('allowfullscreen', '1');
    iframe.setAttribute('allow', 'accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture');
    div.parentNode.replaceChild(iframe, div);
  }

  function initYouTubeVideos() {
    var playerElements = document.querySelectorAll('.youtube-player');
    for (var n = 0; n < playerElements.length; n++) {
      var videoId = playerElements[n].dataset.id;
      var div = document.createElement('div');
      div.setAttribute('data-id', videoId);
      var thumbNode = document.createElement('img');
      thumbNode.src = '//i.ytimg.com/vi/ID/hqdefault.jpg'.replace('ID', videoId);
      div.appendChild(thumbNode);
      var playButton = document.createElement('div');
      playButton.setAttribute('class', 'play');
      div.appendChild(playButton);
      div.onclick = function () {
        labnolIframe(this);
      };
      playerElements[n].appendChild(div);
    }
  }

  document.addEventListener('DOMContentLoaded', initYouTubeVideos);
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Forecasting: Principles and Practice</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Getting started</a>
<ul>
<li class="chapter" data-level="1.1" data-path="what-can-be-forecast.html"><a href="what-can-be-forecast.html"><i class="fa fa-check"></i><b>1.1</b> What can be forecast?</a></li>
<li class="chapter" data-level="1.2" data-path="planning.html"><a href="planning.html"><i class="fa fa-check"></i><b>1.2</b> Forecasting, goals and planning</a></li>
<li class="chapter" data-level="1.3" data-path="determining-what-to-forecast.html"><a href="determining-what-to-forecast.html"><i class="fa fa-check"></i><b>1.3</b> Determining what to forecast</a></li>
<li class="chapter" data-level="1.4" data-path="data-methods.html"><a href="data-methods.html"><i class="fa fa-check"></i><b>1.4</b> Forecasting data and methods</a></li>
<li class="chapter" data-level="1.5" data-path="case-studies.html"><a href="case-studies.html"><i class="fa fa-check"></i><b>1.5</b> Some case studies</a></li>
<li class="chapter" data-level="1.6" data-path="basic-steps.html"><a href="basic-steps.html"><i class="fa fa-check"></i><b>1.6</b> The basic steps in a forecasting task</a></li>
<li class="chapter" data-level="1.7" data-path="perspective.html"><a href="perspective.html"><i class="fa fa-check"></i><b>1.7</b> The statistical forecasting perspective</a></li>
<li class="chapter" data-level="1.8" data-path="intro-exercises.html"><a href="intro-exercises.html"><i class="fa fa-check"></i><b>1.8</b> Exercises</a></li>
<li class="chapter" data-level="1.9" data-path="intro-reading.html"><a href="intro-reading.html"><i class="fa fa-check"></i><b>1.9</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="graphics.html"><a href="graphics.html"><i class="fa fa-check"></i><b>2</b> Time series graphics</a>
<ul>
<li class="chapter" data-level="2.1" data-path="tsibbles.html"><a href="tsibbles.html"><i class="fa fa-check"></i><b>2.1</b> <code>tsibble</code> objects</a></li>
<li class="chapter" data-level="2.2" data-path="time-plots.html"><a href="time-plots.html"><i class="fa fa-check"></i><b>2.2</b> Time plots</a></li>
<li class="chapter" data-level="2.3" data-path="tspatterns.html"><a href="tspatterns.html"><i class="fa fa-check"></i><b>2.3</b> Time series patterns</a></li>
<li class="chapter" data-level="2.4" data-path="seasonal-plots.html"><a href="seasonal-plots.html"><i class="fa fa-check"></i><b>2.4</b> Seasonal plots</a></li>
<li class="chapter" data-level="2.5" data-path="subseries.html"><a href="subseries.html"><i class="fa fa-check"></i><b>2.5</b> Seasonal subseries plots</a></li>
<li class="chapter" data-level="2.6" data-path="scatterplots.html"><a href="scatterplots.html"><i class="fa fa-check"></i><b>2.6</b> Scatterplots</a></li>
<li class="chapter" data-level="2.7" data-path="lag-plots.html"><a href="lag-plots.html"><i class="fa fa-check"></i><b>2.7</b> Lag plots</a></li>
<li class="chapter" data-level="2.8" data-path="acf.html"><a href="acf.html"><i class="fa fa-check"></i><b>2.8</b> Autocorrelation</a></li>
<li class="chapter" data-level="2.9" data-path="wn.html"><a href="wn.html"><i class="fa fa-check"></i><b>2.9</b> White noise</a></li>
<li class="chapter" data-level="2.10" data-path="graphics-exercises.html"><a href="graphics-exercises.html"><i class="fa fa-check"></i><b>2.10</b> Exercises</a></li>
<li class="chapter" data-level="2.11" data-path="graphics-reading.html"><a href="graphics-reading.html"><i class="fa fa-check"></i><b>2.11</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="decomposition.html"><a href="decomposition.html"><i class="fa fa-check"></i><b>3</b> Time series decomposition</a>
<ul>
<li class="chapter" data-level="3.1" data-path="transformations.html"><a href="transformations.html"><i class="fa fa-check"></i><b>3.1</b> Transformations and adjustments</a></li>
<li class="chapter" data-level="3.2" data-path="components.html"><a href="components.html"><i class="fa fa-check"></i><b>3.2</b> Time series components</a></li>
<li class="chapter" data-level="3.3" data-path="moving-averages.html"><a href="moving-averages.html"><i class="fa fa-check"></i><b>3.3</b> Moving averages</a></li>
<li class="chapter" data-level="3.4" data-path="classical-decomposition.html"><a href="classical-decomposition.html"><i class="fa fa-check"></i><b>3.4</b> Classical decomposition</a></li>
<li class="chapter" data-level="3.5" data-path="methods-used-by-official-statistics-agencies.html"><a href="methods-used-by-official-statistics-agencies.html"><i class="fa fa-check"></i><b>3.5</b> Methods used by official statistics agencies</a></li>
<li class="chapter" data-level="3.6" data-path="stl.html"><a href="stl.html"><i class="fa fa-check"></i><b>3.6</b> STL decomposition</a></li>
<li class="chapter" data-level="3.7" data-path="decomposition-exercises.html"><a href="decomposition-exercises.html"><i class="fa fa-check"></i><b>3.7</b> Exercises</a></li>
<li class="chapter" data-level="3.8" data-path="decomposition-reading.html"><a href="decomposition-reading.html"><i class="fa fa-check"></i><b>3.8</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="features.html"><a href="features.html"><i class="fa fa-check"></i><b>4</b> Time series features</a>
<ul>
<li class="chapter" data-level="4.1" data-path="some-simple-statistics.html"><a href="some-simple-statistics.html"><i class="fa fa-check"></i><b>4.1</b> Some simple statistics</a></li>
<li class="chapter" data-level="4.2" data-path="acf-features.html"><a href="acf-features.html"><i class="fa fa-check"></i><b>4.2</b> ACF features</a></li>
<li class="chapter" data-level="4.3" data-path="stlfeatures.html"><a href="stlfeatures.html"><i class="fa fa-check"></i><b>4.3</b> STL Features</a></li>
<li class="chapter" data-level="4.4" data-path="other-features.html"><a href="other-features.html"><i class="fa fa-check"></i><b>4.4</b> Other features</a></li>
<li class="chapter" data-level="4.5" data-path="exploring-australian-tourism-data.html"><a href="exploring-australian-tourism-data.html"><i class="fa fa-check"></i><b>4.5</b> Exploring Australian tourism data</a></li>
<li class="chapter" data-level="4.6" data-path="feast-exercises.html"><a href="feast-exercises.html"><i class="fa fa-check"></i><b>4.6</b> Exercises</a></li>
<li class="chapter" data-level="4.7" data-path="further-reading.html"><a href="further-reading.html"><i class="fa fa-check"></i><b>4.7</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="toolbox.html"><a href="toolbox.html"><i class="fa fa-check"></i><b>5</b> The forecaster’s toolbox</a>
<ul>
<li class="chapter" data-level="5.1" data-path="a-tidy-forecasting-workflow.html"><a href="a-tidy-forecasting-workflow.html"><i class="fa fa-check"></i><b>5.1</b> A tidy forecasting workflow</a></li>
<li class="chapter" data-level="5.2" data-path="simple-methods.html"><a href="simple-methods.html"><i class="fa fa-check"></i><b>5.2</b> Some simple forecasting methods</a></li>
<li class="chapter" data-level="5.3" data-path="residuals.html"><a href="residuals.html"><i class="fa fa-check"></i><b>5.3</b> Fitted values and residuals</a></li>
<li class="chapter" data-level="5.4" data-path="diagnostics.html"><a href="diagnostics.html"><i class="fa fa-check"></i><b>5.4</b> Residual diagnostics</a></li>
<li class="chapter" data-level="5.5" data-path="prediction-intervals.html"><a href="prediction-intervals.html"><i class="fa fa-check"></i><b>5.5</b> Distributional forecasts and prediction intervals</a></li>
<li class="chapter" data-level="5.6" data-path="ftransformations.html"><a href="ftransformations.html"><i class="fa fa-check"></i><b>5.6</b> Forecasting using transformations</a></li>
<li class="chapter" data-level="5.7" data-path="forecasting-decomposition.html"><a href="forecasting-decomposition.html"><i class="fa fa-check"></i><b>5.7</b> Forecasting with decomposition</a></li>
<li class="chapter" data-level="5.8" data-path="accuracy.html"><a href="accuracy.html"><i class="fa fa-check"></i><b>5.8</b> Evaluating point forecast accuracy</a></li>
<li class="chapter" data-level="5.9" data-path="distaccuracy.html"><a href="distaccuracy.html"><i class="fa fa-check"></i><b>5.9</b> Evaluating distributional forecast accuracy</a></li>
<li class="chapter" data-level="5.10" data-path="tscv.html"><a href="tscv.html"><i class="fa fa-check"></i><b>5.10</b> Time series cross-validation</a></li>
<li class="chapter" data-level="5.11" data-path="toolbox-exercises.html"><a href="toolbox-exercises.html"><i class="fa fa-check"></i><b>5.11</b> Exercises</a></li>
<li class="chapter" data-level="5.12" data-path="basics-reading.html"><a href="basics-reading.html"><i class="fa fa-check"></i><b>5.12</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="judgmental.html"><a href="judgmental.html"><i class="fa fa-check"></i><b>6</b> Judgmental forecasts</a>
<ul>
<li class="chapter" data-level="6.1" data-path="judgmental-limitations.html"><a href="judgmental-limitations.html"><i class="fa fa-check"></i><b>6.1</b> Beware of limitations</a></li>
<li class="chapter" data-level="6.2" data-path="judgmental-principles.html"><a href="judgmental-principles.html"><i class="fa fa-check"></i><b>6.2</b> Key principles</a></li>
<li class="chapter" data-level="6.3" data-path="delphimethod.html"><a href="delphimethod.html"><i class="fa fa-check"></i><b>6.3</b> The Delphi method</a></li>
<li class="chapter" data-level="6.4" data-path="analogies.html"><a href="analogies.html"><i class="fa fa-check"></i><b>6.4</b> Forecasting by analogy</a></li>
<li class="chapter" data-level="6.5" data-path="scenarios.html"><a href="scenarios.html"><i class="fa fa-check"></i><b>6.5</b> Scenario forecasting</a></li>
<li class="chapter" data-level="6.6" data-path="new-products.html"><a href="new-products.html"><i class="fa fa-check"></i><b>6.6</b> New product forecasting</a></li>
<li class="chapter" data-level="6.7" data-path="judgmental-adjustments.html"><a href="judgmental-adjustments.html"><i class="fa fa-check"></i><b>6.7</b> Judgmental adjustments</a></li>
<li class="chapter" data-level="6.8" data-path="judgmental-reading.html"><a href="judgmental-reading.html"><i class="fa fa-check"></i><b>6.8</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="regression.html"><a href="regression.html"><i class="fa fa-check"></i><b>7</b> Time series regression models</a>
<ul>
<li class="chapter" data-level="7.1" data-path="regression-intro.html"><a href="regression-intro.html"><i class="fa fa-check"></i><b>7.1</b> The linear model</a></li>
<li class="chapter" data-level="7.2" data-path="least-squares.html"><a href="least-squares.html"><i class="fa fa-check"></i><b>7.2</b> Least squares estimation</a></li>
<li class="chapter" data-level="7.3" data-path="regression-evaluation.html"><a href="regression-evaluation.html"><i class="fa fa-check"></i><b>7.3</b> Evaluating the regression model</a></li>
<li class="chapter" data-level="7.4" data-path="useful-predictors.html"><a href="useful-predictors.html"><i class="fa fa-check"></i><b>7.4</b> Some useful predictors</a></li>
<li class="chapter" data-level="7.5" data-path="selecting-predictors.html"><a href="selecting-predictors.html"><i class="fa fa-check"></i><b>7.5</b> Selecting predictors</a></li>
<li class="chapter" data-level="7.6" data-path="forecasting-regression.html"><a href="forecasting-regression.html"><i class="fa fa-check"></i><b>7.6</b> Forecasting with regression</a></li>
<li class="chapter" data-level="7.7" data-path="nonlinear-regression.html"><a href="nonlinear-regression.html"><i class="fa fa-check"></i><b>7.7</b> Nonlinear regression</a></li>
<li class="chapter" data-level="7.8" data-path="causality.html"><a href="causality.html"><i class="fa fa-check"></i><b>7.8</b> Correlation, causation and forecasting</a></li>
<li class="chapter" data-level="7.9" data-path="regression-matrices.html"><a href="regression-matrices.html"><i class="fa fa-check"></i><b>7.9</b> Matrix formulation</a></li>
<li class="chapter" data-level="7.10" data-path="regression-exercises.html"><a href="regression-exercises.html"><i class="fa fa-check"></i><b>7.10</b> Exercises</a></li>
<li class="chapter" data-level="7.11" data-path="regression-reading.html"><a href="regression-reading.html"><i class="fa fa-check"></i><b>7.11</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="expsmooth.html"><a href="expsmooth.html"><i class="fa fa-check"></i><b>8</b> Exponential smoothing</a>
<ul>
<li class="chapter" data-level="8.1" data-path="ses.html"><a href="ses.html"><i class="fa fa-check"></i><b>8.1</b> Simple exponential smoothing</a></li>
<li class="chapter" data-level="8.2" data-path="holt.html"><a href="holt.html"><i class="fa fa-check"></i><b>8.2</b> Methods with trend</a></li>
<li class="chapter" data-level="8.3" data-path="holt-winters.html"><a href="holt-winters.html"><i class="fa fa-check"></i><b>8.3</b> Methods with seasonality</a></li>
<li class="chapter" data-level="8.4" data-path="taxonomy.html"><a href="taxonomy.html"><i class="fa fa-check"></i><b>8.4</b> A taxonomy of exponential smoothing methods</a></li>
<li class="chapter" data-level="8.5" data-path="ets.html"><a href="ets.html"><i class="fa fa-check"></i><b>8.5</b> Innovations state space models for exponential smoothing</a></li>
<li class="chapter" data-level="8.6" data-path="ets-estimation.html"><a href="ets-estimation.html"><i class="fa fa-check"></i><b>8.6</b> Estimation and model selection</a></li>
<li class="chapter" data-level="8.7" data-path="ets-forecasting.html"><a href="ets-forecasting.html"><i class="fa fa-check"></i><b>8.7</b> Forecasting with ETS models</a></li>
<li class="chapter" data-level="8.8" data-path="expsmooth-exercises.html"><a href="expsmooth-exercises.html"><i class="fa fa-check"></i><b>8.8</b> Exercises</a></li>
<li class="chapter" data-level="8.9" data-path="expsmooth-reading.html"><a href="expsmooth-reading.html"><i class="fa fa-check"></i><b>8.9</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="arima.html"><a href="arima.html"><i class="fa fa-check"></i><b>9</b> ARIMA models</a>
<ul>
<li class="chapter" data-level="9.1" data-path="stationarity.html"><a href="stationarity.html"><i class="fa fa-check"></i><b>9.1</b> Stationarity and differencing</a></li>
<li class="chapter" data-level="9.2" data-path="backshift.html"><a href="backshift.html"><i class="fa fa-check"></i><b>9.2</b> Backshift notation</a></li>
<li class="chapter" data-level="9.3" data-path="AR.html"><a href="AR.html"><i class="fa fa-check"></i><b>9.3</b> Autoregressive models</a></li>
<li class="chapter" data-level="9.4" data-path="MA.html"><a href="MA.html"><i class="fa fa-check"></i><b>9.4</b> Moving average models</a></li>
<li class="chapter" data-level="9.5" data-path="non-seasonal-arima.html"><a href="non-seasonal-arima.html"><i class="fa fa-check"></i><b>9.5</b> Non-seasonal ARIMA models</a></li>
<li class="chapter" data-level="9.6" data-path="arima-estimation.html"><a href="arima-estimation.html"><i class="fa fa-check"></i><b>9.6</b> Estimation and order selection</a></li>
<li class="chapter" data-level="9.7" data-path="arima-r.html"><a href="arima-r.html"><i class="fa fa-check"></i><b>9.7</b> ARIMA modelling in <code>fable</code></a></li>
<li class="chapter" data-level="9.8" data-path="arima-forecasting.html"><a href="arima-forecasting.html"><i class="fa fa-check"></i><b>9.8</b> Forecasting</a></li>
<li class="chapter" data-level="9.9" data-path="seasonal-arima.html"><a href="seasonal-arima.html"><i class="fa fa-check"></i><b>9.9</b> Seasonal ARIMA models</a></li>
<li class="chapter" data-level="9.10" data-path="arima-ets.html"><a href="arima-ets.html"><i class="fa fa-check"></i><b>9.10</b> ARIMA vs ETS</a></li>
<li class="chapter" data-level="9.11" data-path="arima-exercises.html"><a href="arima-exercises.html"><i class="fa fa-check"></i><b>9.11</b> Exercises</a></li>
<li class="chapter" data-level="9.12" data-path="arima-reading.html"><a href="arima-reading.html"><i class="fa fa-check"></i><b>9.12</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="dynamic.html"><a href="dynamic.html"><i class="fa fa-check"></i><b>10</b> Dynamic regression models</a>
<ul>
<li class="chapter" data-level="10.1" data-path="estimation.html"><a href="estimation.html"><i class="fa fa-check"></i><b>10.1</b> Estimation</a></li>
<li class="chapter" data-level="10.2" data-path="regarima.html"><a href="regarima.html"><i class="fa fa-check"></i><b>10.2</b> Regression with ARIMA errors using <code>fable</code></a></li>
<li class="chapter" data-level="10.3" data-path="forecasting.html"><a href="forecasting.html"><i class="fa fa-check"></i><b>10.3</b> Forecasting</a></li>
<li class="chapter" data-level="10.4" data-path="stochastic-and-deterministic-trends.html"><a href="stochastic-and-deterministic-trends.html"><i class="fa fa-check"></i><b>10.4</b> Stochastic and deterministic trends</a></li>
<li class="chapter" data-level="10.5" data-path="dhr.html"><a href="dhr.html"><i class="fa fa-check"></i><b>10.5</b> Dynamic harmonic regression</a></li>
<li class="chapter" data-level="10.6" data-path="lagged-predictors.html"><a href="lagged-predictors.html"><i class="fa fa-check"></i><b>10.6</b> Lagged predictors</a></li>
<li class="chapter" data-level="10.7" data-path="dynamic-exercises.html"><a href="dynamic-exercises.html"><i class="fa fa-check"></i><b>10.7</b> Exercises</a></li>
<li class="chapter" data-level="10.8" data-path="dynamic-reading.html"><a href="dynamic-reading.html"><i class="fa fa-check"></i><b>10.8</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="hierarchical.html"><a href="hierarchical.html"><i class="fa fa-check"></i><b>11</b> Forecasting hierarchical and grouped time series</a>
<ul>
<li class="chapter" data-level="11.1" data-path="hts.html"><a href="hts.html"><i class="fa fa-check"></i><b>11.1</b> Hierarchical and grouped time series</a></li>
<li class="chapter" data-level="11.2" data-path="single-level.html"><a href="single-level.html"><i class="fa fa-check"></i><b>11.2</b> Single level approaches</a></li>
<li class="chapter" data-level="11.3" data-path="reconciliation.html"><a href="reconciliation.html"><i class="fa fa-check"></i><b>11.3</b> Forecast reconciliation</a></li>
<li class="chapter" data-level="11.4" data-path="tourism.html"><a href="tourism.html"><i class="fa fa-check"></i><b>11.4</b> Forecasting Australian domestic tourism</a></li>
<li class="chapter" data-level="11.5" data-path="rec-prob.html"><a href="rec-prob.html"><i class="fa fa-check"></i><b>11.5</b> Reconciled distributional forecasts</a></li>
<li class="chapter" data-level="11.6" data-path="prison.html"><a href="prison.html"><i class="fa fa-check"></i><b>11.6</b> Forecasting Australian prison population</a></li>
<li class="chapter" data-level="11.7" data-path="hierarchical-exercises.html"><a href="hierarchical-exercises.html"><i class="fa fa-check"></i><b>11.7</b> Exercises</a></li>
<li class="chapter" data-level="11.8" data-path="hierarchical-reading.html"><a href="hierarchical-reading.html"><i class="fa fa-check"></i><b>11.8</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="advanced.html"><a href="advanced.html"><i class="fa fa-check"></i><b>12</b> Advanced forecasting methods</a>
<ul>
<li class="chapter" data-level="12.1" data-path="complexseasonality.html"><a href="complexseasonality.html"><i class="fa fa-check"></i><b>12.1</b> Complex seasonality</a></li>
<li class="chapter" data-level="12.2" data-path="prophet.html"><a href="prophet.html"><i class="fa fa-check"></i><b>12.2</b> Prophet model</a></li>
<li class="chapter" data-level="12.3" data-path="VAR.html"><a href="VAR.html"><i class="fa fa-check"></i><b>12.3</b> Vector autoregressions</a></li>
<li class="chapter" data-level="12.4" data-path="nnetar.html"><a href="nnetar.html"><i class="fa fa-check"></i><b>12.4</b> Neural network models</a></li>
<li class="chapter" data-level="12.5" data-path="bootstrap.html"><a href="bootstrap.html"><i class="fa fa-check"></i><b>12.5</b> Bootstrapping and bagging</a></li>
<li class="chapter" data-level="12.6" data-path="advanced-exercises.html"><a href="advanced-exercises.html"><i class="fa fa-check"></i><b>12.6</b> Exercises</a></li>
<li class="chapter" data-level="12.7" data-path="advanced-reading.html"><a href="advanced-reading.html"><i class="fa fa-check"></i><b>12.7</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="practical.html"><a href="practical.html"><i class="fa fa-check"></i><b>13</b> Some practical forecasting issues</a>
<ul>
<li class="chapter" data-level="13.1" data-path="weekly.html"><a href="weekly.html"><i class="fa fa-check"></i><b>13.1</b> Weekly, daily and sub-daily data</a></li>
<li class="chapter" data-level="13.2" data-path="counts.html"><a href="counts.html"><i class="fa fa-check"></i><b>13.2</b> Time series of counts</a></li>
<li class="chapter" data-level="13.3" data-path="limits.html"><a href="limits.html"><i class="fa fa-check"></i><b>13.3</b> Ensuring forecasts stay within limits</a></li>
<li class="chapter" data-level="13.4" data-path="combinations.html"><a href="combinations.html"><i class="fa fa-check"></i><b>13.4</b> Forecast combinations</a></li>
<li class="chapter" data-level="13.5" data-path="aggregates.html"><a href="aggregates.html"><i class="fa fa-check"></i><b>13.5</b> Prediction intervals for aggregates</a></li>
<li class="chapter" data-level="13.6" data-path="backcasting.html"><a href="backcasting.html"><i class="fa fa-check"></i><b>13.6</b> Backcasting</a></li>
<li class="chapter" data-level="13.7" data-path="long-short-ts.html"><a href="long-short-ts.html"><i class="fa fa-check"></i><b>13.7</b> Very long and very short time series</a></li>
<li class="chapter" data-level="13.8" data-path="training-test.html"><a href="training-test.html"><i class="fa fa-check"></i><b>13.8</b> Forecasting on training and test sets</a></li>
<li class="chapter" data-level="13.9" data-path="missing-outliers.html"><a href="missing-outliers.html"><i class="fa fa-check"></i><b>13.9</b> Dealing with outliers and missing values</a></li>
<li class="chapter" data-level="13.10" data-path="further-reading-1.html"><a href="further-reading-1.html"><i class="fa fa-check"></i><b>13.10</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix-using-r.html"><a href="appendix-using-r.html"><i class="fa fa-check"></i>Appendix: Using R</a></li>
<li class="chapter" data-level="" data-path="appendix-for-instructors.html"><a href="appendix-for-instructors.html"><i class="fa fa-check"></i>Appendix: For instructors</a></li>
<li class="chapter" data-level="" data-path="appendix-reviews.html"><a href="appendix-reviews.html"><i class="fa fa-check"></i>Appendix: Reviews</a></li>
<li class="chapter" data-level="" data-path="translations.html"><a href="translations.html"><i class="fa fa-check"></i>Translations</a></li>
<li class="chapter" data-level="" data-path="about-the-authors.html"><a href="about-the-authors.html"><i class="fa fa-check"></i>About the authors</a></li>
<li class="chapter" data-level="" data-path="buy-a-print-version.html"><a href="buy-a-print-version.html"><i class="fa fa-check"></i>Buy a print version</a></li>
<li class="chapter" data-level="" data-path="report-an-error.html"><a href="report-an-error.html"><i class="fa fa-check"></i>Report an error</a></li>
<li class="chapter" data-level="" data-path="bibliography.html"><a href="bibliography.html"><i class="fa fa-check"></i>Bibliography</a></li>
<li class="divider"></li>
<li><a href="https://OTexts.com" target="blank">Published by OTexts™ with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Forecasting: Principles and Practice <font size=-1>(3rd ed)</font></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="reconciliation" class="section level2 hasAnchor" number="11.3">
<h2><span class="header-section-number">11.3</span> Forecast reconciliation<a href="reconciliation.html#reconciliation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><em>Warning: the rest of this chapter is more advanced and assumes a knowledge of some basic matrix algebra.</em></p>
<div id="matrix-notation" class="section level3 unnumbered hasAnchor">
<h3>Matrix notation<a href="reconciliation.html#matrix-notation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Recall that Equations <a href="hts.html#eq:toplevel">(11.1)</a> and <a href="hts.html#eq:middlelevel">(11.2)</a> represent how data, that adhere to the hierarchical structure of Figure <a href="hts.html#fig:HierTree">11.1</a>, aggregate. Similarly <a href="hts.html#eq:middlelevelAB">(11.3)</a> and <a href="hts.html#eq:middlelevelXY">(11.4)</a> represent how data, that adhere to the grouped structure of Figure <a href="hts.html#fig:GroupTree">11.6</a>, aggregate. These equations can be thought of as aggregation constraints or summing equalities, and can be more efficiently represented using matrix notation.</p>
<p>For any aggregation structure we construct an <span class="math inline">\(n\times m\)</span> matrix <span class="math inline">\(\bm{S}\)</span> (referred to as the “summing matrix”) which dictates the way in which the bottom-level series aggregate.</p>
<p>For the hierarchical structure in Figure <a href="hts.html#fig:HierTree">11.1</a>, we can write
<span class="math display">\[
  \begin{bmatrix}
    y_{t} \\
    \y{A}{t} \\
    \y{B}{t} \\
    \y{AA}{t} \\
    \y{AB}{t} \\
    \y{AC}{t} \\
    \y{BA}{t} \\
    \y{BB}{t}
  \end{bmatrix}
  =
  \begin{bmatrix}
    1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 \\
    1 &amp; 1 &amp; 1 &amp; 0 &amp; 0 \\
    0 &amp; 0 &amp; 0 &amp; 1 &amp; 1 \\
    1  &amp; 0  &amp; 0  &amp; 0  &amp; 0  \\
    0  &amp; 1  &amp; 0  &amp; 0  &amp; 0  \\
    0  &amp; 0  &amp; 1  &amp; 0  &amp; 0  \\
    0  &amp; 0  &amp; 0  &amp; 1  &amp; 0  \\
    0  &amp; 0  &amp; 0  &amp; 0  &amp; 1
  \end{bmatrix}
  \begin{bmatrix}
    \y{AA}{t} \\
    \y{AB}{t} \\
    \y{AC}{t} \\
    \y{BA}{t} \\
    \y{BB}{t}
  \end{bmatrix}
\]</span>
or in more compact notation
<span class="math display" id="eq:smatrix">\[\begin{equation}
  \bm{y}_t=\bm{S}\bm{b}_{t},
  \tag{11.5}
\end{equation}\]</span>
where <span class="math inline">\(\bm{y}_t\)</span> is an <span class="math inline">\(n\)</span>-dimensional vector of all the observations in the hierarchy at time <span class="math inline">\(t\)</span>, <span class="math inline">\(\bm{S}\)</span> is the summing matrix, and <span class="math inline">\(\bm{b}_{t}\)</span> is an <span class="math inline">\(m\)</span>-dimensional vector of all the observations in the bottom level of the hierarchy at time <span class="math inline">\(t\)</span>. Note that the first row in the summing matrix <span class="math inline">\(\bm{S}\)</span> represents Equation <a href="hts.html#eq:toplevel">(11.1)</a>, the second and third rows represent <a href="hts.html#eq:middlelevel">(11.2)</a>. The rows below these comprise an <span class="math inline">\(m\)</span>-dimensional identity matrix <span class="math inline">\(\bm{I}_m\)</span> so that each bottom-level observation on the right hand side of the equation is equal to itself on the left hand side.</p>
<p>Similarly for the grouped structure of Figure <a href="hts.html#fig:GroupTree">11.6</a> we write
<span class="math display">\[
  \begin{bmatrix}
    y_{t} \\
    \y{A}{t} \\
    \y{B}{t} \\
    \y{X}{t} \\
    \y{Y}{t} \\
    \y{AX}{t} \\
    \y{AY}{t} \\
    \y{BX}{t} \\
    \y{BY}{t}
  \end{bmatrix}
  =
  \begin{bmatrix}
    1 &amp; 1 &amp; 1 &amp; 1 \\
    1 &amp; 1 &amp; 0 &amp; 0 \\
    0 &amp; 0 &amp; 1 &amp; 1 \\
    1 &amp; 0 &amp; 1 &amp; 0 \\
    0 &amp; 1 &amp; 0 &amp; 1 \\
    1 &amp; 0 &amp; 0 &amp; 0 \\
    0 &amp; 1 &amp; 0 &amp; 0 \\
    0 &amp; 0 &amp; 1 &amp; 0 \\
    0 &amp; 0 &amp; 0 &amp; 1
  \end{bmatrix}
  \begin{bmatrix}
    \y{AX}{t} \\
    \y{AY}{t} \\
    \y{BX}{t} \\
    \y{BY}{t}
  \end{bmatrix},
\]</span>
or
<span class="math display" id="eq:smatrix2">\[\begin{equation}
  \bm{y}_t=\bm{S}\bm{b}_{t},
  \tag{11.6}
\end{equation}\]</span>
where the second and third rows of <span class="math inline">\(\bm{S}\)</span> represent Equation <a href="hts.html#eq:middlelevelAB">(11.3)</a> and the fourth and fifth rows represent <a href="hts.html#eq:middlelevelXY">(11.4)</a>.</p>
</div>
<div id="mapping-matrices" class="section level3 unnumbered hasAnchor">
<h3>Mapping matrices<a href="reconciliation.html#mapping-matrices" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This matrix notation allows us to represent all forecasting methods for hierarchical or grouped time series using a common notation.</p>
<p>Suppose we forecast all series ignoring any aggregation constraints. We call these the <strong>base forecasts</strong> and denote them by <span class="math inline">\(\hat{\bm{y}}_h\)</span> where <span class="math inline">\(h\)</span> is the forecast horizon. They are stacked in the same order as the data <span class="math inline">\(\bm{y}_t\)</span>.</p>
<p>Then all coherent forecasting approaches for either hierarchical or grouped structures can be represented as<a href="#fn23" class="footnote-ref" id="fnref23"><sup>23</sup></a>
<span class="math display" id="eq:SG">\[\begin{equation}
  \tilde{\bm{y}}_h=\bm{S}\bm{G}\hat{\bm{y}}_h,
  \tag{11.7}
\end{equation}\]</span>
where <span class="math inline">\(\bm{G}\)</span> is a matrix that maps the base forecasts into the bottom level, and the summing matrix <span class="math inline">\(\bm{S}\)</span> sums these up using the aggregation structure to produce a set of <strong>coherent forecasts</strong> <span class="math inline">\(\tilde{\bm{y}}_h\)</span>.</p>
<p>The <span class="math inline">\(\bm{G}\)</span> matrix is defined according to the approach implemented. For example if the bottom-up approach is used to forecast the hierarchy of Figure <a href="hts.html#fig:HierTree">11.1</a>, then
<span class="math display">\[\bm{G}=
  \begin{bmatrix}
    0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
    0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0\\
    0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0\\
    0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0\\
    0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1\\
  \end{bmatrix}.
  \]</span>
Notice that <span class="math inline">\(\bm{G}\)</span> contains two partitions. The first three columns zero out the base forecasts of the series above the bottom level, while the <span class="math inline">\(m\)</span>-dimensional identity matrix picks only the base forecasts of the bottom level. These are then summed by the <span class="math inline">\(\bm{S}\)</span> matrix.</p>
<p>If any of the top-down approaches were used then
<span class="math display">\[
  \bm{G}=
    \begin{bmatrix}
      p_1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
      p_2 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
      p_3 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
      p_4 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
      p_5 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
    \end{bmatrix}.
\]</span>
The first column includes the set of proportions that distribute the base forecasts of the top level to the bottom level. These are then summed up by the <span class="math inline">\(\bm{S}\)</span> matrix. The rest of the columns zero out the base forecasts below the highest level of aggregation.</p>
<p>For a middle out approach, the <span class="math inline">\(\bm{G}\)</span> matrix will be a combination of the above two. Using a set of proportions, the base forecasts of some pre-chosen level will be disaggregated to the bottom level, all other base forecasts will be zeroed out, and the bottom-level forecasts will then be summed up the hierarchy via the summing matrix.</p>
</div>
<div id="forecast-reconciliation" class="section level3 unnumbered hasAnchor">
<h3>Forecast reconciliation<a href="reconciliation.html#forecast-reconciliation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Equation <a href="reconciliation.html#eq:SG">(11.7)</a> shows that pre-multiplying any set of base forecasts with <span class="math inline">\(\bm{S}\bm{G}\)</span> will return a set of coherent forecasts.</p>
<p>The traditional methods considered so far are limited in that they only use base forecasts from a single level of aggregation which have either been aggregated or disaggregated to obtain forecasts at all other levels. Hence, they use limited information. However, in general, we could use other <span class="math inline">\(\bm{G}\)</span> matrices, and then <span class="math inline">\(\bm{S}\bm{G}\)</span> combines and reconciles all the base forecasts in order to produce coherent forecasts.</p>
<p>In fact, we can find the optimal <span class="math inline">\(\bm{G}\)</span> matrix to give the most accurate reconciled forecasts.</p>
</div>
<div id="the-mint-optimal-reconciliation-approach" class="section level3 unnumbered hasAnchor">
<h3>The MinT optimal reconciliation approach<a href="reconciliation.html#the-mint-optimal-reconciliation-approach" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<!-- {#MinT} -->
<p><span class="citation">Wickramasuriya et al. (<a href="#ref-Mint">2019</a>)</span> found a <span class="math inline">\(\bm{G}\)</span> matrix that minimises the total forecast variance of the set of coherent forecasts, leading to the MinT (Minimum Trace) optimal reconciliation approach.</p>
<p>Suppose we generate coherent forecasts using Equation <a href="reconciliation.html#eq:SG">(11.7)</a>. First we want to make sure we have unbiased forecasts. If the base forecasts <span class="math inline">\(\hat{\bm{y}}_h\)</span> are unbiased, then the coherent forecasts <span class="math inline">\(\tilde{\bm{y}}_h\)</span> will be unbiased provided<a href="#fn24" class="footnote-ref" id="fnref24"><sup>24</sup></a> <span class="math inline">\(\bm{S}\bm{G}\bm{S}=\bm{S}\)</span>. This provides a constraint on the matrix <span class="math inline">\(\bm{G}\)</span>. Interestingly, no top-down method satisfies this constraint, so all top-down approaches result in biased coherent forecasts.</p>
<p>Next we need to find the errors in our forecasts. <span class="citation">Wickramasuriya et al. (<a href="#ref-Mint">2019</a>)</span> show that the variance-covariance matrix of the <span class="math inline">\(h\)</span>-step-ahead coherent forecast errors is given by
<span class="math display">\[\begin{equation*}
\bm{V}_h = \text{Var}[\bm{y}_{T+h}-\tilde{\bm{y}}_h]=\bm{S}\bm{G}\bm{W}_h\bm{G}&#39;\bm{S}&#39;
\end{equation*}\]</span>
where <span class="math inline">\(\bm{W}_h=\text{Var}[(\bm{y}_{T+h}-\hat{\bm{y}}_h)]\)</span> is the variance-covariance matrix of the corresponding base forecast errors.</p>
<p>The objective is to find a matrix <span class="math inline">\(\bm{G}\)</span> that minimises the error variances of the coherent forecasts. These error variances are on the diagonal of the matrix <span class="math inline">\(\bm{V}_h\)</span>, and so the sum of all the error variances is given by the trace of the matrix <span class="math inline">\(\bm{V}_h\)</span>. <span class="citation">Wickramasuriya et al. (<a href="#ref-Mint">2019</a>)</span> show that the matrix <span class="math inline">\(\bm{G}\)</span> which minimises the trace of <span class="math inline">\(\bm{V}_h\)</span> such that <span class="math inline">\(\bm{S}\bm{G}\bm{S}=\bm{S}\)</span>, is given by
<span class="math display">\[
  \bm{G}=(\bm{S}&#39;\bm{W}_h^{-1}\bm{S})^{-1}\bm{S}&#39;\bm{W}_h^{-1}.
\]</span>
Therefore, the optimally reconciled forecasts are given by
<span class="math display" id="eq:MinT">\[\begin{equation}
\tag{11.8}
  \tilde{\bm{y}}_h=\bm{S}(\bm{S}&#39;\bm{W}_h^{-1}\bm{S})^{-1}\bm{S}&#39;\bm{W}_h^{-1}\hat{\bm{y}}_h.
\end{equation}\]</span></p>
<p>We refer to this as the MinT (or Minimum Trace) optimal reconciliation approach. MinT is implemented by <code>min_trace()</code> within the <code>reconcile()</code> function.</p>
<p>To use this in practice, we need to estimate <span class="math inline">\(\bm{W}_h\)</span>, the forecast error variance of the <span class="math inline">\(h\)</span>-step-ahead base forecasts. This can be difficult, and so we provide four simplifying approximations that have been shown to work well in both simulations and in practice.</p>
<ol style="list-style-type: decimal">
<li><p>Set <span class="math inline">\(\bm{W}_h=k_h\bm{I}\)</span> for all <span class="math inline">\(h\)</span>, where <span class="math inline">\(k_{h} &gt; 0\)</span>.<a href="#fn25" class="footnote-ref" id="fnref25"><sup>25</sup></a> This is the most simplifying assumption to make, and means that <span class="math inline">\(\bm{G}\)</span> is independent of the data, providing substantial computational savings. The disadvantage, however, is that this specification does not account for the differences in scale between the levels of the structure, or for relationships between series.</p>
<p>Setting <span class="math inline">\(\bm{W}_h=k_h\bm{I}\)</span> in <a href="reconciliation.html#eq:MinT">(11.8)</a> gives the ordinary least squares (OLS) estimator we introduced in Section <a href="regression-matrices.html#regression-matrices">7.9</a> with <span class="math inline">\(\bm{X}=\bm{S}\)</span> and <span class="math inline">\(\bm{y}=\hat{\bm{y}}\)</span>. Hence this approach is usually referred to as OLS reconciliation. It is implemented in <code>min_trace()</code> by setting <code>method = "ols"</code>.</p></li>
<li><p>Set <span class="math inline">\(\bm{W}_{h} = k_{h}\text{diag}(\hat{\bm{W}}_{1})\)</span> for all <span class="math inline">\(h\)</span>, where <span class="math inline">\(k_{h} &gt; 0\)</span>,
<span class="math display">\[
     \hat{\bm{W}}_{1} = \frac{1}{T}\sum_{t=1}^{T}\bm{e}_{t}\bm{e}_{t}&#39;,
\]</span>
and <span class="math inline">\(\bm{e}_{t}\)</span> is an <span class="math inline">\(n\)</span>-dimensional vector of residuals of the models that generated the base forecasts stacked in the same order as the data.</p>
<p>This specification scales the base forecasts using the variance of the residuals and it is therefore referred to as the WLS (weighted least squares) estimator using <em>variance scaling</em>. The approach is implemented in <code>min_trace()</code> by setting <code>method = "wls_var"</code>.</p></li>
<li><p>Set <span class="math inline">\(\bm{W}_{h}=k_{h}\bm{\Lambda}\)</span> for all <span class="math inline">\(h\)</span>, where <span class="math inline">\(k_{h} &gt; 0\)</span>, <span class="math inline">\(\bm{\Lambda}=\text{diag}(\bm{S}\bm{1})\)</span>, and <span class="math inline">\(\bm{1}\)</span> is a unit vector of dimension <span class="math inline">\(m\)</span> (the number of bottom-level series). This specification assumes that the bottom-level base forecast errors each have variance <span class="math inline">\(k_{h}\)</span> and are uncorrelated between nodes. Hence each element of the diagonal <span class="math inline">\(\bm{\Lambda}\)</span> matrix contains the number of forecast error variances contributing to each node. This estimator only depends on the structure of the aggregations, and not on the actual data. It is therefore referred to as <em>structural scaling</em>. Applying the structural scaling specification is particularly useful in cases where residuals are not available, and so variance scaling cannot be applied; for example, in cases where the base forecasts are generated by judgmental forecasting (Chapter <a href="judgmental.html#judgmental">6</a>). The approach is implemented in <code>min_trace()</code> by setting <code>method = "wls_struct"</code>.</p></li>
<li><p>Set <span class="math inline">\(\bm{W}_h = k_h \bm{W}_1\)</span> for all <span class="math inline">\(h\)</span>, where <span class="math inline">\(k_h&gt;0\)</span>. Here we only assume that the error covariance matrices are proportional to each other, and we directly estimate the full one-step covariance matrix <span class="math inline">\(\bm{W}_1\)</span>. The most obvious and simple way would be to use the sample covariance. This is implemented in <code>min_trace()</code> by setting <code>method = "mint_cov"</code>.</p>
<p>However, for cases where the number of bottom-level series <span class="math inline">\(m\)</span> is large compared to the length of the series <span class="math inline">\(T\)</span>, this is not a good estimator. Instead we use a shrinkage estimator which shrinks the sample covariance to a diagonal matrix. This is implemented in <code>min_trace()</code> by setting <code>method = "mint_shrink"</code>.</p></li>
</ol>
<p>In summary, unlike any other existing approach, the optimal reconciliation forecasts are generated using all the information available within a hierarchical or a grouped structure. This is important, as particular aggregation levels or groupings may reveal features of the data that are of interest to the user and are important to be modelled. These features may be completely hidden or not easily identifiable at other levels.</p>
<p>For example, consider the Australian tourism data introduced in Section <a href="hts.html#hts">11.1</a>, where the hierarchical structure followed the geographic division of a country into states and regions. Some areas will be largely summer destinations, while others may be winter destinations. We saw in Figure <a href="hts.html#fig:seasonStates">11.4</a> the contrasting seasonal patterns between the northern and the southern states. These differences will be smoothed at the country level due to aggregation.</p>
</div>
</div>
<h3>Bibliography<a href="bibliography.html#bibliography" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-HynEtAl2011" class="csl-entry">
Hyndman, R. J., Ahmed, R. A., Athanasopoulos, G., &amp; Shang, H. L. (2011). Optimal combination forecasts for hierarchical time series. <em>Computational Statistics and Data Analysis</em>, <em>55</em>(9), 2579–2589. <a href="https://doi.org/10.1016/j.csda.2011.03.006">[DOI]</a>
</div>
<div id="ref-PanEtAl2020_Geometry" class="csl-entry">
Panagiotelis, A., Athanasopoulos, G., Gamakumara, P., &amp; Hyndman, R. J. (2021). Forecast reconciliation: A geometric view with new insights on bias correction. <em>International Journal of Forecasting</em>, <em>37</em>(1), 343–359. <a href="https://doi.org/10.1016/j.ijforecast.2020.06.004">[DOI]</a>
</div>
<div id="ref-Mint" class="csl-entry">
Wickramasuriya, S. L., Athanasopoulos, G., &amp; Hyndman, R. J. (2019). Optimal forecast reconciliation for hierarchical and grouped time series through trace minimization. <em>Journal of the American Statistical Association</em>, <em>114</em>(526), 804–819. <a href="https://doi.org/10.1080/01621459.2018.1448825">[DOI]</a>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="23">
<li id="fn23"><p>Actually, some recent nonlinear reconciliation methods require a slightly more complicated equation. This equation is for general linear reconciliation methods.<a href="reconciliation.html#fnref23" class="footnote-back">↩︎</a></p></li>
<li id="fn24"><p>This “unbiasedness preserving” constraint was first introduced in <span class="citation">Hyndman et al. (<a href="#ref-HynEtAl2011">2011</a>)</span>. <span class="citation">Panagiotelis et al. (<a href="#ref-PanEtAl2020_Geometry">2021</a>)</span> show that this is equivalent to <span class="math inline">\(\bm{S}\bm{G}\)</span> being a projection matrix onto the <span class="math inline">\(m\)</span>-dimensional coherent subspace for which the aggregation constraints hold.<a href="reconciliation.html#fnref24" class="footnote-back">↩︎</a></p></li>
<li id="fn25"><p>Note that <span class="math inline">\(k_{h}\)</span> is a proportionality constant. It does not need to be estimated or specified here as it gets cancelled out in <a href="reconciliation.html#eq:MinT">(11.8)</a>.<a href="reconciliation.html#fnref25" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="single-level.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tourism.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
